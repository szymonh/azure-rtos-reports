# Summary

Several of the usb host classes perform a modulo operation by device endpoint descriptor wMaxPacketSize which may be maliciously set to zero.

# Description

Functions listed below include modulo by wMaxPacketSize which is read from the usb device's endpoint descriptor.
- _ux_host_class_cdc_ecm_transmission_callback
- _ux_host_class_pima_write
- _ux_host_class_pima_read
- _ux_host_class_pima_object_send
- _ux_host_class_pima_object_get

A attacker may set the endpoint descriptor wMaxPacketSize to zero and once a modulo operation is triggered this will result in an undefined condition and potentially reboot with denial of service.
Sample code from cdc ecm transmission callback:
```
    if (transfer_request -> ux_transfer_request_completion_code == UX_SUCCESS)
    {

        /* Check if the transfer length is not zero and it is multiple of MPS.  */
        if ((transfer_request -> ux_transfer_request_requested_length != 0)
            (transfer_request -> ux_transfer_request_requested_length % (transfer_request -> ux_transfer_request_endpoint -> ux_endpoint_descriptor.wMaxPacketSize &amp; UX_MAX_PACKET_SIZE_MASK)) == 0)
        {

            /* Set transfer request length to zero.  */
            transfer_request -> ux_transfer_request_requested_length =  0;

            /* Send the transfer.  */
            _ux_host_stack_transfer_request(transfer_request);

            /* Finished processing.  */
            return;
        }
```
One may observe that wMaxPacketSize set to zero on a malicious usb device endpoint will trigger an undefined condition and a crash.

# Reproduction steps

Prepare a test application (i.e. cdc ecm).
Prepare malicious usb device with endpoint descriptor wMaxPacketSize set to zero.
Trigger a code path including division by wMaxPacketSize.
Observe a potential crash.

# References

https://github.com/azure-rtos/usbx/blob/master/common/usbx_host_classes/src/ux_host_class_cdc_ecm_transmission_callback.c

# Affected versions

<= 6.1.8
